@page "/"
@using TraktSync.Config
@using TraktSync.Trakt

@inject IJSRuntime JsRuntime
@inject ISnackbar Snackbar
@inject ITraktClient TraktClient
@inject ConfigHandler ConfigHandler

<PageTitle>Trakt sync</PageTitle>

<MudText Typo="Typo.h2">Welcome to trakt sync</MudText>

<MudExpansionPanels MultiExpansion>
    <MudExpansionPanel Text="Trakt" Expanded>
        <TraktComponent Config="_config" OnChangeConfig="UpdateSync"/>
    </MudExpansionPanel>
    <MudExpansionPanel Text="Emby">
        Panel Two Content
    </MudExpansionPanel>
    <MudExpansionPanel Text="Plex">
        Panel Three Content
    </MudExpansionPanel>
</MudExpansionPanels>

@code {
    private Config _config = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _config = ConfigHandler.GetAsync() ?? new Config();
        }
        catch
        {
            _config = new Config();
        }

        await Task.CompletedTask;
    }

    public void UpdateSync(Config config)
    {
        _config = config;
        StateHasChanged();
    }
}